package watson;

/** Holds one search result, associated with one document.
 * 
 * Note the meaning of score and max_score.
 * Lower scores are better (and can be negative).
 * worst_score is the worst possible score for this result (which may not have existed in the set)
 * Scores are later scaled according to ( 
 * 
 * */ 
public class Result implements Comparable {
	// Inherent
	public String docid;
	public String text;
	public String title;
	public enum Oracle {Unknown, Correct, Incorrect};
	public Oracle correct;
	// Calculated
	private double score;
	// Dependent on engine
	// You can set this via inheritance if you prefer.
	public double best_score = 0; 
	public double worst_score = 1;
	
	/** Convenience constructor */
	public Result(String docid, String title, String text, double score) {
		this.docid = docid;
		this.title = title;
		this.text = text;
		setScore(score);
	}
	
	public Result(String docid, String title, String text, double score, Oracle correct) {
		this(docid, title, text, score);
		this.correct = correct;
	}
	
	/** Copy constructor */
	public Result(Result result) {
		this.docid = result.docid;
		this.title = result.title;
		this.text = result.text;
		this.correct = result.correct;
		// Don't normalize the score twice.
		this.score = result.score;
		this.best_score = result.best_score;
		this.worst_score = result.worst_score;
	}
	
	/** Return normalized score.
	 * This may not be same number you put into setScore.
	 */
	public double getScore() {
		return score;
	}
	
	
	/** Autogenerated hashcode: includes only docid */
	@Override
	public int hashCode() {
		final int prime = 31;
		int result = 1;
		result = prime * result + ((docid == null) ? 0 : docid.hashCode());
		return result;
	}

	/** Results are equal if their docids are equal
	 * TODO: Use fuzzy matches
	 * Note that the transitive property will not remain
	 * */
	@Override
	public boolean equals(Object obj) {
		if (this == obj)
			return true;
		if (obj == null)
			return false;
		if (getClass() != obj.getClass())
			return false;
		Result other = (Result) obj;
		if (docid == null) {
			if (other.docid != null)
				return false;
		} else if (!docid.equals(other.docid))
			return false;
		return true;
	}

	/** Normalize scores to be from 0 to 1, less is better. */
	public Result setScore(double raw) {
		score = (raw - best_score) / (worst_score - best_score);
		return this;
	}

	@Override
	public int compareTo(Object other) {
		return new Double(score).compareTo( ((Result) other).getScore());
	}
}